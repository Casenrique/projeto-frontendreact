if (showPlAds) {
    _adtypes = {
        'mpu-billboard': ['Section-Unit1', 'Section-Unit2', 'Section-Unit3', 'Section-Unit4', 'Section-Unit5', 'Section-Unit6', 'Section-Unit7', 'Section-Unit8', 'Section-Unit9', 'Section-Unit10'],
        'mpu': ['Article-Unit1', 'Article-Unit2', 'Article-Unit3', 'Article-Unit4', 'Article-Unit5', 'Article-Unit6', 'Article-Unit7', 'Article-Unit8', 'Article-Unit9', 'Article-Unit10', 'Article-Unit11', 'Article-Unit12', 'Article-Unit13', 'Article-Unit14', 'Article-Unit15', 'Article-Unit16', 'Article-Unit17', 'Article-Unit18', 'Article-Unit19', 'Article-Unit20', 'Article-Unit21', 'Article-Unit22', 'Article-Unit23', 'Article-Unit24', 'Article-Unit25', 'Article-Unit26', 'Article-Unit27', 'Article-Unit28', 'Article-Unit29', 'Article-Unit30', 'Article-Unit31', 'Article-Unit32', 'Article-Unit33', 'Article-Unit34', 'Article-Unit35', 'Article-Unit36', 'Article-Unit37', 'Article-Unit38', 'Article-Unit39', 'Article-Unit40'],
        'mpu-tall': ['Article-Unit7'],
        'sponsorship-badge' : ['ArticleSponsorshipBadge'],
        'skin': ['Skin'],
        'homepage_ad': ['Homepage-Unit2', 'Homepage-Unit3', 'Homepage-Unit4', 'Homepage-Unit5', 'Homepage-Unit6'],
        'leaderboard': ['Homepage-Unit7'],
        'leaderboard-article': ['Article-Unit10'],
        'leaderboard-hub': ['Section-Unit10'],
        'mobile-top-bar': ['SA-Unit21'],
        'sticky-mobile': ['Anchor'],
        'tablet': ['SA-Tablet'],
        'out-of-page': ['SA-OutOfPage'],
        'interscroller': ['Interscroller'],
        'homepage-top-billboard': ['Homepage-Unit1'],
        'top-skins-mobile': ['Skin']

    };
    var used = [], type, index, length;

    for (type in _adtypes) {
        if (_existing_ads.indexOf(type) > -1) {
            if (type === 'mpu-billboard') {
                for (index = 0, length = _existing_ads.length; index < length; ++index) {
                    if (_existing_ads[index] === 'mpu-billboard') {
                        used.push(_adtypes['mpu-billboard'].shift());
                    }
                }
            } else if (type === 'mpu') {
                for (index = 0, length = _existing_ads.length; index < length; ++index) {
                    if (_existing_ads[index] === 'mpu') {
                        used.push(_adtypes['mpu'].shift());
                    }
                }
            } else if (type === 'homepage') {
                for (index = 0, length = _existing_ads.length; index < length; ++index) {
                    if (_existing_ads[index] === 'mpu') {
                        used.push(_adtypes['mpu'].shift());
                    }
                }
            } else {
                for (index = 0, length = _adtypes[type].length; index < length; ++index) {
                    used.push(_adtypes[type][index]);
                }
            }
        }
    }

    for (type in _adtypes) {
        if (type === 'mpu') {
            for (index = 0, length = _adtypes['mpu'].length; index < length; ++index) {
                    used.push(_adtypes['mpu'][index]);
                }
            }
        }

    window.AD_UNITS_TOGGLE_ON = used;
    var skinLoaded = false;
    var time = 0;

    function initAds() {
        time = time + 1;
        if (typeof makeAdsMove != "undefined") {
            if (typeof jQuery != "undefined") {
                makeAdsMove(jQuery);
            }
        }

        var adsArray = window.AD_UNITS_TOGGLE_ON;
        adsArray.forEach(function (ad) {
            if (googletag) {
                if(ad){
                    googletag.cmd.push(function () {
                        googletag.display(ad);
                    });
                }
            } else {
                setTimeout(function () {
                    if (time < 5) {
                        initAds();
                    }

                }, 1000);
            }
        });
    }

    function initSkinAds() {
        return;
        var adsArray = window.AD_UNITS_TOGGLE_ON;
        //console.log("Ads on skin: ", adsArray);

        adsArray.forEach(function (ad) {
            if (ad == "Skin") {
                //console.log("ad: ", ad);

                googletag.cmd.push(function () {
                    googletag.display(ad);
                });

                skinLoaded = true;
            }

        });
    }
}


function closeLanguageBanner() {
    setCookieLocal("pocket_hide_lang_banner", true, 365);
    hideBannerDiv();
}


function hideBannerDiv() {
    //$('.footer-banner-div').hide();
    if (document.getElementById("footer-banner-div")) {
        document.getElementById("footer-banner-div").style.display = "none";
    }

}

function showBannerDiv() {
    //$('.footer-banner-div').show();
    if (document.getElementById("footer-banner-div")) {
        document.getElementById("footer-banner-div").style.display = "block";
    }
}


function loadSlick(isMobile = false) {
    var slidesCount = $('.trending-slide').length;
    $('.trending-slide').show();

    if (slidesCount > (isMobile ? 1 : 2)) {
        if(typeof $('.topics-slides').slick !== "undefined" ){
            $('.topics-slides').slick({
                slidesToShow: viewportWidth >= 980 ? slides_to_show : 1,
                slidesToScroll: 1,
                autoplay: true,
                autoplaySpeed: 5000,
                arrows: true
            });
        }

    }
}

function failureCallback() {
    console.log(111);
}

function getCookieLocal(name) {
    if (_cookies === null) {
        _cookies = navigator.cookieEnabled ||
            (
                'cookie' in document &&
                (
                    document.cookie.length > 0 ||
                    (document.cookie = '__t').indexOf.call(document.cookie, '__t') > -1
                )
            );
    }

    if (_cookies === false) {
        return false;
    }

    // bug in regexp so space and \s is used to make sure we match
    var matches = document.cookie.match(new RegExp('(^|;[\s ]+)' + name.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") + '=([^;]+)'));

    return matches && matches.length >= 3 ? matches[2] : null;
}


function setCookieLocal(name, value, days) {
    var expires = new Date();
    expires.setDate(expires.getDate() + days);
    document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value) + '; expires=' + expires.toUTCString() + '; Secure; SameSite=none' + ";path=/";
}


function loadScript(src) {
    return new Promise(function (resolve, reject) {
        var s;
        s = document.createElement('script');
        s.src = src;
        s.onload = resolve;
        s.onerror = reject;
        document.head.appendChild(s);
    });
}


function getCurrentColorMode() {
    var body = document.getElementsByTagName("BODY")[0];

    color_mode = window.getCookieLocal("color_mode");

    // COOKIE
    if (color_mode) {
        if (color_mode && color_mode == 'dark-mode') {
            //$('body').addClass('dark-mode');
            body.className += " dark-mode";
            //$(".dark_mode_switcher_image").attr("src", "{#{ asset( 'bundles/pocketlintapp/images/moon_dark.svg', 'cdn') }#}" );
        } else {
            //$(".dark_mode_switcher_image").attr("src", "{#{ asset( 'bundles/pocketlintapp/images/moon.svg', 'cdn') }#}" );
        }
    } else {
        // OS THEME

        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            // dark mode
            color_mode = 'dark-mode';
            body.className += " dark-mode";
            //$('body').addClass('dark-mode');
            //$(".dark_mode_switcher_image").attr("src", "{{ asset( 'bundles/pocketlintapp/images/moon_dark.svg', 'cdn') }}" );

        } else {
            //TIME
            currentTime = new Date();
            time = currentTime.getTime();
            hours = currentTime.getHours();

            if (isBetweenHours('22', '7')) {
                color_mode == 'dark-mode';
                body.className += " dark-mode";
                //$('body').addClass('dark-mode');
                //$(".dark_mode_switcher_image").attr("src", "{{ asset( 'bundles/pocketlintapp/images/moon_dark.svg', 'cdn') }}");
            }
        }
    }
}

function isBetweenHours(startHour, endHour) {
    var now = new Date().getHours();

    return (now >= startHour || now <= endHour);
}


function toggleLanguageSwitcher() {
    if (document.getElementById("languageChooser").style.display === "block") {
        document.getElementById("languageChooser").style.display = "none";
    } else {
        document.getElementById("languageChooser").style.display = "block";
    }

}


function addAdminLink(article_id, base_url, typegroup, img_url) {
    let name = 'pocket_admin';
    let matches = document.cookie.match(new RegExp('(^|;[\s ]+)' + name.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") + '=([^;]+)'));
    if (matches != null && matches[2] === "true") {
        let adminLink = '<a id="admin_link" target="_blank" href="https://cms.' + base_url + '/articles/' + article_id + '/live" rel="nofollow">' +
            '<img src="' + img_url + '">' +
            '</a>' +
            '<a id="clear_article_cache" target="_self" href="?forceCacheRefresh=2" rel="nofollow">' +
            'Force Cache Renew' +
            '</a>';

        document.getElementsByClassName('details')[0].insertAdjacentHTML('beforeend', adminLink);
    }
}

// setup listener
function handleOnSlideChange(sw, i) {
    sw.on('slideChange', function (sw) {
        // Image attribution
        var attribution = sw.slides[sw.activeIndex].firstElementChild.attributes["data-attribution"].value;
        var url_attribution = sw.slides[sw.activeIndex].firstElementChild.attributes["data-url_attribution"].value;

        var attributionElement = sw.el.parentElement.querySelector('#attribution-gallery')
        sw.el.parentElement.removeChild(attributionElement);

        if (url_attribution != "") {
            sw.el.parentElement.insertAdjacentHTML("afterbegin", "<a id='attribution-gallery' href='" + url_attribution + "' rel='nofollow' target='_blank' class='attribution case3' style='padding-top: 10px;'>" + attribution + "</a>")
        } else {
            sw.el.parentElement.insertAdjacentHTML("afterbegin", '<span id="attribution-gallery" class="attribution case3" style="padding-top: 10px;">' + attribution + "</span>")
        }

        // Image caption
        var caption = sw.slides[sw.activeIndex].firstElementChild.attributes["data-caption"].value;
        var captionElement = sw.el.parentElement.querySelector('#widget_caption')
        if (caption && captionElement) {
            captionElement.innerHTML = '<b>' + caption.toUpperCase() + '</b>';
        }
    });
}